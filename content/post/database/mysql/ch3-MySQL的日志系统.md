---
title: "MySQL的日志系统"
date: 2020-06-05T22:07:21+08:00
lastmod: 2020-06-05T22:07:21+08:00
description: ""
draft: false
tags: ["mysql"]
categories: ["mysql"]
---

## 日志类型

> ​		  MySQL主要有两种日志类型，一种是`物理日志`（记录在某个数据页上做了什么修改)，一种是`逻辑日志`(存储了逻辑SQL修改语句)。`redo log`属于物理日志，`binlog`和`undo log`属于逻辑日志，其中物理日志的恢复速度远快于逻辑日志。
>
> `redo log`和`undo log`都属于`InnoDB`引擎层下的`事务日志（transaction log）`。

## 重做日志  (redo log)

### 预写式技术 (Write Ahead logging, WAL)

> ​        InnoDB 引擎对数据更新，是先将更新记录写入到重做日志，在系统空闲时或者按照设定的更新策略再将日志中的内容更新到磁盘中，这就是`预写式技术 (Write Ahead logging, WAL)`，这种技术可以大大减少IO操作的频率，提升数据刷新的效率。

###  重做日志的策略
> ​		  重做日志（redo log）是 InnoDB 引擎层的日志，用来记录事务操作引起数据的变化，记录的是数据页的物理修改，提供`前滚`操作，`redo log 保证事务的持久性`。重做日志由两部分组成，一是内存中的`重做日志缓冲区 (redo log buffer)`，因为重做日志缓冲区在内存中，所以它是`易失的`，另一个就是在磁盘上的`重做日志文件 (redo log file)`，它是持久的。

​		  当我们在一个事务中尝试对数据进行修改时，它会先将数据从磁盘读入内存，并更新内存中缓存的数据，然后生成一条重做日志并写入重做日志缓存，当事务真正提交时，MySQL 会将重做日志缓存中的内容刷新到重做日志文件，再将内存中的数据更新到磁盘上。

​	     值得注意的是，redo log 的大小是固定的，为了能够持续不断的对更新记录进行写入，在redo log日志中设置了两个标志位置，`checkpoint`和`write pos`。

![](../../../../images/redo log.png)

